name: Runner Terminal
on: [workflow_dispatch, push]
jobs:
  build:
    runs-on: windows-latest
    defaults:
      run:
        shell: C:\msys64\msys2_shell.cmd -mingw64 -defterm -no-start -c "source $(cygpath '{0}')"
        working-directory: C:\d\a\
    steps:
      - name: Simple
        run: echo I am running in $(pwd)
        shell: C:\msys64\msys2_shell.cmd -mingw64 -defterm -no-start -c "source $(cygpath '{0}')"
      - name: Create directories
        run: |
          mkdir /d/a/MinGW
          mkdir /d/a/release
      - name: Clone MinGW
        run: |
          cd /d/a/MinGW
          git clone https://github.com/mirror/mingw-w64.git .
      - name: Build headers
        run: |
          cd /d/a/MinGW/mingw-w64-headers
          ./configure \
            --prefix="/d/a/release/" \
            --enable-lib32 \
            --enable-lib64 \
            --enable-experimental \
            --host=x86_64-w64-mingw32 \
            --target=x86_64-w64-mingw32 \
            --with-default-msvcrt=ucrt \
            --enable-wildcard
          make install
      - name: Configure runtime
        run: |
          cd /d/a/MinGW/mingw-w64-crt
          ./configure \
            --prefix="/d/a/release" \
            --enable-lib32 \
            --enable-lib64 \
            --enable-experimental \
            --host=x86_64-w64-mingw32 \
            --target=x86_64-w64-mingw32 \
            --with-default-msvcrt=ucrt \
            --enable-wildcard
      - name: Build runtime
        run: |
          cd /d/a/MinGW/mingw-w64-crt
          make CFLAGS="-w"
      - name: Strip & install runtime
        run: |
          cd /d/a/MinGW/mingw-w64-crt
          make install-strip
      - name: Create artifact
        uses: actions/upload-artifact@v2
        with:
          name: Win-Open-C-Runtime
          path: /d/a/release/
