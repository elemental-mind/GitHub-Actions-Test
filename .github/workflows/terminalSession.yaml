name: Runner Terminal
on: [workflow_dispatch, push]
jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Test mingw shell
        run: echo Sleeping for 10s && sleep 10s
        shell: C:\msys2\msys2_shell -mingw64 -defterm -c "{0}"
      - name: Create directories
        run: |
          cd /d/a/
          mkdir MinGW
          mkdir release
        shell: bash
      - name: Clone MinGW
        run: |
          cd /d/a/MinGW
          git clone https://github.com/mirror/mingw-w64.git .
        shell: bash
      - name: Build headers
        run: |
          cd /d/a/MinGW/mingw-w64-headers
          ./configure \
            --prefix="/d/a/release/" \
            --enable-lib32 \
            --enable-lib64 \
            --enable-experimental \
            --host=x86_64-w64-mingw32 \
            --target=x86_64-w64-mingw32 \
            --with-default-msvcrt=ucrt \
            --enable-wildcard
          make install
        shell: C:\msys64\mingw64.exe {0}
      - name: Configure runtime
        run: |
          cd /d/a/MinGW/mingw-w64-crt
          ./configure \
            --prefix="/d/a/release" \
            --enable-lib32 \
            --enable-lib64 \
            --enable-experimental \
            --host=x86_64-w64-mingw32 \
            --target=x86_64-w64-mingw32 \
            --with-default-msvcrt=ucrt \
            --enable-wildcard
        shell: bash
      - name: Build runtime
        run: |
          cd /d/a/MinGW/mingw-w64-crt
          make CFLAGS="-w"
        shell: bash
      - name: Strip & install runtime
        run: |
          cd /d/a/MinGW/mingw-w64-crt
          make install-strip
        shell: bash
      - name: Create artifact
        uses: actions/upload-artifact@v2
        with:
          name: Win-Open-C-Runtime
          path: /d/a/release/
